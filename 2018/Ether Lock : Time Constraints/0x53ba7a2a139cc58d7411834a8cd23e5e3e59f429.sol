['pragma solidity ^0.4.23;\n', '\n', 'contract EthMashTower {\n', '\n', '    address public owner;\n', '    mapping (address => uint) public withdrawals;\n', '\n', '    int round;\n', '    uint registered;\n', '    mapping (int => address[7]) public participants;\n', '\n', '    constructor() public {\n', '        owner = msg.sender;\n', '        round = 1;\n', '        registered = 0;\n', '    }\n', '\n', '    function publicGetBalance(address player) view public returns (uint) {\n', '        return withdrawals[player];\n', '    }\n', '\n', '    function publicGetState() view public returns (address[7][2]) {\n', '        return [\n', '            participants[round - 1],\n', '            participants[round]\n', '        ];\n', '    }\n', '\n', '    function userWithdraw() public {\n', '        require(withdrawals[msg.sender] > 0);\n', '        uint amount = withdrawals[msg.sender];\n', '        withdrawals[msg.sender] = 0;\n', '        msg.sender.transfer(amount);\n', '    }\n', '\n', '    function userRegister() public payable {\n', '        require(msg.value == 105 finney);\n', '        require(registered < 4);\n', '\n', '        withdrawals[owner] += 5 finney;\n', '        participants[round][registered] = msg.sender;\n', '\n', '        if (registered == 1) {\n', '            calcWinner(0, 1, 4, 150 finney);\n', '        } else if (registered == 3) {\n', '            calcWinner(2, 3, 5, 150 finney);\n', '            calcWinner(4, 5, 6, 100 finney);\n', '        }\n', '\n', '        if (registered < 3) {\n', '            registered++;\n', '        } else {\n', '            round++;\n', '            registered = 0;\n', '        }\n', '    }\n', '\n', '    function calcWinner(uint first, uint second, uint winner, uint reward) private {\n', '        uint random = (uint(blockhash(block.number - 1)) + uint(participants[round][first]) + uint(participants[round][second]));\n', '\n', '        if (random % 2 == 0) {\n', '            participants[round][winner] = participants[round][first];\n', '            withdrawals[participants[round][first]] += reward;\n', '        } else {\n', '            participants[round][winner] = participants[round][second];\n', '            withdrawals[participants[round][second]] += reward;\n', '        }\n', '    }\n', '}']