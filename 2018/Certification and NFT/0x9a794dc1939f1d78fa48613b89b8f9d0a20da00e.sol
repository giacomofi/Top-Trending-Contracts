['/* Simple token - simple token for PreICO and ICO\n', '   Copyright (C) 2017  Sergey Sherkunov <leinlawun@leinlawun.org>\n', '   Copyright (C) 2017  OOM.AG <info@oom.ag>\n', '\n', '   This file is part of simple token.\n', '\n', '   Token is free software: you can redistribute it and/or modify\n', '   it under the terms of the GNU General Public License as published by\n', '   the Free Software Foundation, either version 3 of the License, or\n', '   (at your option) any later version.\n', '\n', '   This program is distributed in the hope that it will be useful,\n', '   but WITHOUT ANY WARRANTY; without even the implied warranty of\n', '   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n', '   GNU General Public License for more details.\n', '\n', '   You should have received a copy of the GNU General Public License\n', '   along with this program.  If not, see <https://www.gnu.org/licenses/>.  */\n', '\n', 'pragma solidity ^0.4.18;\n', '\n', 'library SafeMath {\n', '    function add(uint256 a, uint256 b) internal pure returns (uint256 c) {\n', '        c = a + b;\n', '\n', '        assert(c >= a);\n', '    }\n', '\n', '    function sub(uint256 a, uint256 b) internal pure returns (uint256 c) {\n', '        assert(b <= a);\n', '\n', '        c = a - b;\n', '    }\n', '\n', '    function mul(uint256 a, uint256 b) internal pure returns (uint256 c) {\n', '        c = a * b;\n', '\n', '        assert(c / a == b);\n', '    }\n', '\n', '    function div(uint256 a, uint256 b) internal pure returns (uint256 c) {\n', '        c = a / b;\n', '    }\n', '\n', '    function mod(uint256 a, uint256 b) internal pure returns (uint256 c) {\n', '        c = a % b;\n', '    }\n', '\n', '    function min(uint256 a, uint256 b) internal pure returns (uint256 c) {\n', '        c = a;\n', '\n', '        if(a > b)\n', '           c = b;\n', '    }\n', '}\n', '\n', 'contract ABXToken {\n', '    using SafeMath for uint256;\n', '\n', '    address public owner;\n', '\n', '    address public minter;\n', '\n', '    string public name;\n', '\n', '    string public symbol;\n', '\n', '    uint8 public decimals;\n', '\n', '    uint256 public totalSupply;\n', '\n', '    mapping(address => uint256) public balanceOf;\n', '\n', '    mapping(address => mapping(address => uint256)) public allowance;\n', '\n', '    event Transfer(address indexed oldTokensHolder,\n', '                   address indexed newTokensHolder, uint256 tokensNumber);\n', '\n', '    //An Attack Vector on Approve/TransferFrom Methods:\n', '    //https://github.com/ethereum/EIPs/issues/20#issuecomment-263524729\n', '    event Transfer(address indexed tokensSpender,\n', '                   address indexed oldTokensHolder,\n', '                   address indexed newTokensHolder, uint256 tokensNumber);\n', '\n', '    event Approval(address indexed tokensHolder, address indexed tokensSpender,\n', '                   uint256 newTokensNumber);\n', '\n', '    //An Attack Vector on Approve/TransferFrom Methods:\n', '    //https://github.com/ethereum/EIPs/issues/20#issuecomment-263524729\n', '    event Approval(address indexed tokensHolder, address indexed tokensSpender,\n', '                   uint256 oldTokensNumber, uint256 newTokensNumber);\n', '\n', '    modifier onlyOwner {\n', '        require(owner == msg.sender);\n', '\n', '        _;\n', '    }\n', '\n', '    //ERC20 Short Address Attack:\n', '    //https://vessenes.com/the-erc20-short-address-attack-explained\n', '    //https://blog.golemproject.net/how-to-find-10m-by-just-reading-blockchain-6ae9d39fcd95\n', '    //https://ericrafaloff.com/analyzing-the-erc20-short-address-attack\n', '    modifier checkPayloadSize(uint256 size) {\n', '        require(msg.data.length == size + 4);\n', '\n', '        _;\n', '    }\n', '\n', '    modifier onlyNotNullTokenHolder(address tokenHolder) {\n', '        require(tokenHolder != address(0));\n', '\n', '        _;\n', '    }\n', '\n', '    function ABXToken(string _name, string _symbol, uint8 _decimals,\n', '                      uint256 _totalSupply) public {\n', '        owner = msg.sender;\n', '        name = _name;\n', '        symbol = _symbol;\n', '        decimals = _decimals;\n', '        totalSupply = _totalSupply.mul(10 ** uint256(decimals));\n', '\n', '        require(decimals <= 77);\n', '\n', '        balanceOf[this] = totalSupply;\n', '    }\n', '\n', '    function setOwner(address _owner) public onlyOwner returns(bool) {\n', '        owner = _owner;\n', '\n', '        return true;\n', '    }\n', '\n', '    function setMinter(address _minter) public onlyOwner returns(bool) {\n', '        safeApprove(this, minter, 0);\n', '\n', '        minter = _minter;\n', '\n', '        safeApprove(this, minter, balanceOf[this]);\n', '\n', '        return true;\n', '    }\n', '\n', '    //ERC20 Short Address Attack:\n', '    //https://vessenes.com/the-erc20-short-address-attack-explained\n', '    //https://blog.golemproject.net/how-to-find-10m-by-just-reading-blockchain-6ae9d39fcd95\n', '    //https://ericrafaloff.com/analyzing-the-erc20-short-address-attack\n', '    function transfer(address newTokensHolder, uint256 tokensNumber) public\n', '                     checkPayloadSize(2 * 32) returns(bool) {\n', '        transfer(msg.sender, newTokensHolder, tokensNumber);\n', '\n', '        return true;\n', '    }\n', '\n', '    //An Attack Vector on Approve/TransferFrom Methods:\n', '    //https://github.com/ethereum/EIPs/issues/20#issuecomment-263524729\n', '    //\n', '    //ERC20 Short Address Attack:\n', '    //https://vessenes.com/the-erc20-short-address-attack-explained\n', '    //https://blog.golemproject.net/how-to-find-10m-by-just-reading-blockchain-6ae9d39fcd95\n', '    //https://ericrafaloff.com/analyzing-the-erc20-short-address-attack\n', '    function transferFrom(address oldTokensHolder, address newTokensHolder,\n', '                          uint256 tokensNumber) public checkPayloadSize(3 * 32)\n', '                         returns(bool) {\n', '        allowance[oldTokensHolder][msg.sender] =\n', '            allowance[oldTokensHolder][msg.sender].sub(tokensNumber);\n', '\n', '        transfer(oldTokensHolder, newTokensHolder, tokensNumber);\n', '\n', '        Transfer(msg.sender, oldTokensHolder, newTokensHolder, tokensNumber);\n', '\n', '        return true;\n', '    }\n', '\n', '    //ERC20 Short Address Attack:\n', '    //https://vessenes.com/the-erc20-short-address-attack-explained\n', '    //https://blog.golemproject.net/how-to-find-10m-by-just-reading-blockchain-6ae9d39fcd95\n', '    //https://ericrafaloff.com/analyzing-the-erc20-short-address-attack\n', '    function approve(address tokensSpender, uint256 newTokensNumber) public\n', '                    checkPayloadSize(2 * 32) returns(bool) {\n', '        safeApprove(msg.sender, tokensSpender, newTokensNumber);\n', '\n', '        return true;\n', '    }\n', '\n', '    //An Attack Vector on Approve/TransferFrom Methods:\n', '    //https://github.com/ethereum/EIPs/issues/20#issuecomment-263524729\n', '    //\n', '    //ERC20 Short Address Attack:\n', '    //https://vessenes.com/the-erc20-short-address-attack-explained\n', '    //https://blog.golemproject.net/how-to-find-10m-by-just-reading-blockchain-6ae9d39fcd95\n', '    //https://ericrafaloff.com/analyzing-the-erc20-short-address-attack\n', '    function approve(address tokensSpender, uint256 oldTokensNumber,\n', '                     uint256 newTokensNumber) public checkPayloadSize(3 * 32)\n', '                    returns(bool) {\n', '        require(allowance[msg.sender][tokensSpender] == oldTokensNumber);\n', '\n', '        unsafeApprove(msg.sender, tokensSpender, newTokensNumber);\n', '\n', '        Approval(msg.sender, tokensSpender, oldTokensNumber, newTokensNumber);\n', '\n', '        return true;\n', '    }\n', '\n', '    function transfer(address oldTokensHolder, address newTokensHolder,\n', '                      uint256 tokensNumber) private\n', '                      onlyNotNullTokenHolder(oldTokensHolder) {\n', '        balanceOf[oldTokensHolder] =\n', '            balanceOf[oldTokensHolder].sub(tokensNumber);\n', '\n', '        balanceOf[newTokensHolder] =\n', '            balanceOf[newTokensHolder].add(tokensNumber);\n', '\n', '        Transfer(oldTokensHolder, newTokensHolder, tokensNumber);\n', '    }\n', '\n', '    //An Attack Vector on Approve/TransferFrom Methods:\n', '    //https://github.com/ethereum/EIPs/issues/20#issuecomment-263524729\n', '    function unsafeApprove(address tokensHolder, address tokensSpender,\n', '                           uint256 newTokensNumber) private\n', '                          onlyNotNullTokenHolder(tokensHolder) {\n', '        allowance[tokensHolder][tokensSpender] = newTokensNumber;\n', '\n', '        Approval(msg.sender, tokensSpender, newTokensNumber);\n', '    }\n', '    \n', '    //An Attack Vector on Approve/TransferFrom Methods:\n', '    //https://github.com/ethereum/EIPs/issues/20#issuecomment-263524729\n', '    function safeApprove(address tokensHolder, address tokensSpender,\n', '                         uint256 newTokensNumber) private {\n', '        require(allowance[tokensHolder][tokensSpender] == 0 ||\n', '                newTokensNumber == 0);\n', '\n', '        unsafeApprove(tokensHolder, tokensSpender, newTokensNumber);\n', '    }\n', '}']